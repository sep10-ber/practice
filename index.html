<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로또 날짜-번호 네트워크 그래프 (JSON 파일 참조)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
        }
        #chart-container {
            position: relative;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 95%;
            max-width: 1200px; 
            cursor: grab;
        }
        #chart-container:active {
            cursor: grabbing;
        }
        svg {
            display: block;
            width: 100%;
            height: auto;
        }
        .controls {
            background-color: white;
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: center;
        }
        .controls label {
            font-weight: 500;
            font-size: 0.9em;
        }
        .controls select, .controls button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #fff;
            font-size: 0.9em;
        }
        .controls button {
            border: none;
            background-color: #1a237e;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .controls button:hover {
            background-color: #283593;
        }
        .header {
            text-align: center;
            padding: 0 20px 20px 20px;
            width: 100%;
        }
        h1 {
            font-size: 2em;
            font-weight: bold;
            color: #1a237e;
            margin-bottom: 8px;
        }
        p {
            font-size: 1.1em;
            color: #555;
        }
        .links line {
            stroke: #ccc;
            stroke-opacity: 0.7;
            transition: stroke-opacity 0.3s, stroke 0.3s;
        }
        .nodes g {
            cursor: pointer;
        }
        .nodes circle {
            stroke: #fff;
            stroke-width: 2px;
            transition: opacity 0.3s, transform 0.3s;
        }
        .nodes text {
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
            dominant-baseline: central;
        }
        .number-text {
            font-size: 12px;
            fill: #fff;
        }
        .date-text {
            font-size: 10px;
            fill: #333;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 20px;
            width: 95%;
        }
        @media (min-width: 1024px) {
            .main-container {
                flex-direction: row;
            }
        }
        .graph-panel {
            width: 100%;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>역대 로또 당첨번호 네트워크 비교</h1>
        <p>두 기간을 각각 설정하여 패턴의 변화를 탐색해보세요.</p>
    </div>

    <div class="main-container">
        <!-- Left Panel -->
        <div class="graph-panel">
            <div class="controls">
                <label for="year1">연도:</label>
                <select id="year1"></select>
                <label for="month1">월:</label>
                <select id="month1"></select>
                <button id="generate1">그래프 생성</button>
            </div>
            <div id="chart-container-1" class="chart-container"></div>
        </div>
        <!-- Right Panel -->
        <div class="graph-panel">
            <div class="controls">
                <label for="year2">연도:</label>
                <select id="year2"></select>
                <label for="month2">월:</label>
                <select id="month2"></select>
                <button id="generate2">그래프 생성</button>
            </div>
            <div id="chart-container-2" class="chart-container"></div>
        </div>
    </div>

    <script>
        // --- lotto.json 파일이 있다고 가정하고 데이터를 변수에 저장 ---
        // 실제 환경에서는 이 부분을 d3.json("lotto.json").then(...)으로 변경하면 됩니다.
        const lottoJSONData = [
            {"draw_number":1185,"date":"2025-08-16","winning_numbers":[6,17,22,28,29,32],"bonus_number":38},
            {"draw_number":1184,"date":"2025-08-09","winning_numbers":[14,16,23,25,31,37],"bonus_number":42},
            {"draw_number":1183,"date":"2025-08-02","winning_numbers":[4,15,17,23,27,36],"bonus_number":31},
            {"draw_number":1182,"date":"2025-07-26","winning_numbers":[1,13,21,25,28,31],"bonus_number":22},
            {"draw_number":1181,"date":"2025-07-19","winning_numbers":[8,10,14,20,33,41],"bonus_number":28},
            {"draw_number":1180,"date":"2025-07-12","winning_numbers":[6,12,18,37,40,41],"bonus_number":3},
            {"draw_number":1179,"date":"2025-07-05","winning_numbers":[3,16,18,24,40,44],"bonus_number":21},
            {"draw_number":1178,"date":"2025-06-28","winning_numbers":[5,6,11,27,43,44],"bonus_number":17},
            {"draw_number":1177,"date":"2025-06-21","winning_numbers":[3,7,15,16,19,23],"bonus_number":27},
            {"draw_number":1176,"date":"2025-06-14","winning_numbers":[1,5,12,13,23,44],"bonus_number":35},
            {"draw_number":1175,"date":"2025-06-07","winning_numbers":[1,2,12,23,34,43],"bonus_number":3},
            {"draw_number":1174,"date":"2025-05-31","winning_numbers":[1,12,16,20,21,37],"bonus_number":42},
            {"draw_number":1173,"date":"2025-05-24","winning_numbers":[1,10,13,22,34,45],"bonus_number":20},
            {"draw_number":1172,"date":"2025-05-17","winning_numbers":[11,12,17,27,30,38],"bonus_number":3},
            {"draw_number":1171,"date":"2025-05-10","winning_numbers":[1,2,4,14,23,45],"bonus_number":33},
            {"draw_number":1170,"date":"2025-05-03","winning_numbers":[7,10,15,21,22,37],"bonus_number":39},
            {"draw_number":1169,"date":"2025-04-26","winning_numbers":[4,8,11,12,27,32],"bonus_number":20},
            {"draw_number":1168,"date":"2025-04-19","winning_numbers":[4,10,11,22,25,43],"bonus_number":30},
            {"draw_number":1167,"date":"2025-04-12","winning_numbers":[3,4,16,30,33,37],"bonus_number":13},
            {"draw_number":1166,"date":"2025-04-05","winning_numbers":[1,10,22,23,30,35],"bonus_number":39},
            {"draw_number":1165,"date":"2025-03-29","winning_numbers":[13,19,21,26,33,43],"bonus_number":30},
            {"draw_number":1164,"date":"2025-03-22","winning_numbers":[6,11,21,25,33,38],"bonus_number":4},
            {"draw_number":1163,"date":"2025-03-15","winning_numbers":[1,12,20,21,24,32],"bonus_number":19},
            {"draw_number":1162,"date":"2025-03-08","winning_numbers":[1,14,16,24,34,41],"bonus_number":20},
            {"draw_number":1161,"date":"2025-03-01","winning_numbers":[1,10,11,19,21,28],"bonus_number":41},
            {"draw_number":1160,"date":"2025-02-22","winning_numbers":[1,3,4,13,30,33],"bonus_number":26},
            {"draw_number":1159,"date":"2025-02-15","winning_numbers":[4,11,28,39,42,45],"bonus_number":6},
            {"draw_number":1158,"date":"2025-02-08","winning_numbers":[1,2,15,24,35,43],"bonus_number":32},
            {"draw_number":1157,"date":"2025-02-01","winning_numbers":[6,14,15,19,21,41],"bonus_number":37},
            {"draw_number":1156,"date":"2025-01-25","winning_numbers":[2,4,10,13,23,44],"bonus_number":16},
            {"draw_number":1155,"date":"2025-01-18","winning_numbers":[10,12,29,31,40,44],"bonus_number":2},
            {"draw_number":1154,"date":"2025-01-11","winning_numbers":[7,12,15,24,34,43],"bonus_number":29},
            {"draw_number":1153,"date":"2025-01-04","winning_numbers":[1,3,8,9,14,33],"bonus_number":26},
            {"draw_number":1152,"date":"2024-12-28","winning_numbers":[1,12,16,23,28,43],"bonus_number":35},
            {"draw_number":1151,"date":"2024-12-21","winning_numbers":[16,20,25,28,39,40],"bonus_number":30},
            {"draw_number":1150,"date":"2024-12-14","winning_numbers":[1,10,13,22,35,45],"bonus_number":3},
            {"draw_number":1149,"date":"2024-12-07","winning_numbers":[5,14,15,20,35,44],"bonus_number":1},
            {"draw_number":1148,"date":"2024-11-30","winning_numbers":[2,11,18,20,22,39],"bonus_number":32},
            {"draw_number":1147,"date":"2024-11-23","winning_numbers":[1,5,10,12,21,39],"bonus_number":42},
            {"draw_number":1146,"date":"2024-11-16","winning_numbers":[1,4,11,28,41,43],"bonus_number":3},
            {"draw_number":1145,"date":"2024-11-09","winning_numbers":[1,11,23,33,40,44],"bonus_number":19},
            {"draw_number":1144,"date":"2024-11-02","winning_numbers":[10,11,14,23,30,39],"bonus_number":33},
            {"draw_number":1143,"date":"2024-10-26","winning_numbers":[3,10,22,30,33,45],"bonus_number":2},
            {"draw_number":1142,"date":"2024-10-19","winning_numbers":[14,21,23,32,34,44],"bonus_number":27},
            {"draw_number":1141,"date":"2024-10-12","winning_numbers":[6,18,28,30,32,38],"bonus_number":13},
            {"draw_number":1140,"date":"2024-10-05","winning_numbers":[1,9,25,28,31,33],"bonus_number":42},
            {"draw_number":1139,"date":"2024-09-28","winning_numbers":[4,8,13,23,27,43],"bonus_number":15},
            {"draw_number":1138,"date":"2024-09-21","winning_numbers":[2,15,23,27,32,45],"bonus_number":1},
            {"draw_number":1137,"date":"2024-09-14","winning_numbers":[11,12,17,20,21,27],"bonus_number":42},
            {"draw_number":1136,"date":"2024-09-07","winning_numbers":[6,13,15,23,24,42],"bonus_number":30},
            {"draw_number":1135,"date":"2024-08-31","winning_numbers":[3,5,10,23,27,33],"bonus_number":12},
            {"draw_number":1134,"date":"2024-08-24","winning_numbers":[1,2,8,16,17,39],"bonus_number":12},
            {"draw_number":1133,"date":"2024-08-17","winning_numbers":[1,10,13,28,39,41],"bonus_number":31},
            {"draw_number":1132,"date":"2024-08-10","winning_numbers":[10,11,20,28,30,40],"bonus_number":1},
            {"draw_number":1131,"date":"2024-08-03","winning_numbers":[2,10,14,28,37,40],"bonus_number":4},
            {"draw_number":1130,"date":"2024-07-27","winning_numbers":[2,5,12,14,23,31],"bonus_number":34},
            {"draw_number":1129,"date":"2024-07-20","winning_numbers":[1,10,12,22,23,28],"bonus_number":4},
            {"draw_number":1128,"date":"2024-07-13","winning_numbers":[8,12,16,23,28,45],"bonus_number":39},
            {"draw_number":1127,"date":"2024-07-06","winning_numbers":[2,3,11,12,19,20],"bonus_number":10},
            {"draw_number":1126,"date":"2024-06-29","winning_numbers":[1,3,10,12,14,35],"bonus_number":24},
            {"draw_number":1125,"date":"2024-06-22","winning_numbers":[6,12,23,27,33,40],"bonus_number":10},
            {"draw_number":1124,"date":"2024-06-15","winning_numbers":[3,8,14,30,32,33],"bonus_number":36},
            {"draw_number":1123,"date":"2024-06-08","winning_numbers":[3,8,17,30,33,34],"bonus_number":28},
            {"draw_number":1122,"date":"2024-06-01","winning_numbers":[1,10,17,21,26,34],"bonus_number":11},
            {"draw_number":1121,"date":"2024-05-25","winning_numbers":[2,10,12,13,20,40],"bonus_number":11},
            {"draw_number":1120,"date":"2024-05-18","winning_numbers":[1,2,14,23,26,43],"bonus_number":12},
            {"draw_number":1119,"date":"2024-05-11","winning_numbers":[2,10,15,19,35,40],"bonus_number":1},
            {"draw_number":1118,"date":"2024-05-04","winning_numbers":[3,9,10,29,34,44],"bonus_number":21},
            {"draw_number":1117,"date":"2024-04-27","winning_numbers":[3,4,9,30,33,36],"bonus_number":7},
            {"draw_number":1116,"date":"2024-04-20","winning_numbers":[15,16,23,27,33,40],"bonus_number":24},
            {"draw_number":1115,"date":"2024-04-13","winning_numbers":[7,12,23,32,34,43],"bonus_number":25},
            {"draw_number":1114,"date":"2024-04-06","winning_numbers":[10,16,19,32,33,38],"bonus_number":6},
            {"draw_number":1113,"date":"2024-03-30","winning_numbers":[11,13,20,21,32,44],"bonus_number":3},
            {"draw_number":1112,"date":"2024-03-23","winning_numbers":[10,11,15,22,43,45],"bonus_number":1},
            {"draw_number":1111,"date":"2024-03-16","winning_numbers":[3,13,30,33,43,45],"bonus_number":4},
            {"draw_number":1110,"date":"2024-03-09","winning_numbers":[3,7,11,20,22,41],"bonus_number":24},
            {"draw_number":1109,"date":"2024-03-02","winning_numbers":[9,13,30,33,43,44],"bonus_number":4},
            {"draw_number":1108,"date":"2024-02-24","winning_numbers":[7,19,26,37,39,44],"bonus_number":23},
            {"draw_number":1107,"date":"2024-02-17","winning_numbers":[6,14,30,31,40,41],"bonus_number":29},
            {"draw_number":1106,"date":"2024-02-10","winning_numbers":[1,9,12,23,24,43],"bonus_number":34},
            {"draw_number":1105,"date":"2024-02-03","winning_numbers":[6,16,24,27,31,44],"bonus_number":30},
            {"draw_number":1104,"date":"2024-01-27","winning_numbers":[8,19,25,34,37,39],"bonus_number":4},
            {"draw_number":1103,"date":"2024-01-20","winning_numbers":[9,18,20,22,38,44],"bonus_number":24},
            {"draw_number":1102,"date":"2024-01-13","winning_numbers":[20,31,32,40,41,45],"bonus_number":13},
            {"draw_number":1101,"date":"2024-01-06","winning_numbers":[3,13,29,38,42,45],"bonus_number":30},
            {"draw_number":1100,"date":"2023-12-30","winning_numbers":[17,25,33,35,38,44],"bonus_number":26},
            {"draw_number":601,"date":"2014-06-07","winning_numbers":[1,2,3,4,5,6],"bonus_number":7}
        ];

        const yearSelect1 = document.getElementById('year1');
        const monthSelect1 = document.getElementById('month1');
        const generateBtn1 = document.getElementById('generate1');

        const yearSelect2 = document.getElementById('year2');
        const monthSelect2 = document.getElementById('month2');
        const generateBtn2 = document.getElementById('generate2');

        let simulation1, simulation2;

        function setupControls(yearSelect, monthSelect, isFirstPanel, allRows) {
            const years = [...new Set(allRows.map(d => d.date.substring(0, 4)))].sort((a, b) => b - a);
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}년`;
                yearSelect.appendChild(option);
            });

            for (let i = 1; i <= 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i}월`;
                monthSelect.appendChild(option);
            }
            
            const latestDate = new Date(allRows[0].date.replace(/\./g, '-'));
            let targetDate = latestDate;

            if (!isFirstPanel) {
                const d = new Date(latestDate);
                d.setMonth(d.getMonth() - 1);
                targetDate = d;
            }
            
            yearSelect.value = targetDate.getFullYear();
            monthSelect.value = targetDate.getMonth() + 1;
        }

        function createGraph(containerId, yearSelect, monthSelect, simInstance, allRows) {
            if (simInstance) {
                simInstance.stop(); 
            }
            d3.select(`#${containerId}`).html(""); 

            const selectedYear = +yearSelect.value;
            const selectedMonth = +monthSelect.value;

            const filteredRows = allRows.filter(d => {
                const date = new Date(d.date.replace(/\./g, '-'));
                return date.getFullYear() === selectedYear && (date.getMonth() + 1) === selectedMonth;
            });

            if (filteredRows.length === 0) {
                d3.select(`#${containerId}`).append("p").style("padding", "20px").text("해당 기간에 데이터가 없습니다.");
                return;
            }
            
            const dateNodes = filteredRows.map(d => ({ id: d.date, type: 'date' }));
            const numberCounts = {};
            const links = [];
            
            filteredRows.forEach(row => {
                const numbers = row.winning_numbers;
                numbers.forEach(num => {
                    numberCounts[num] = (numberCounts[num] || 0) + 1;
                    links.push({ source: row.date, target: `num-${num}` });
                });
            });

            const numberNodes = Object.keys(numberCounts).map(num => ({
                id: `num-${num}`, type: 'number', number: +num, count: numberCounts[num]
            }));

            const allNodes = [...dateNodes, ...numberNodes];

            const width = document.getElementById(containerId).clientWidth;
            const height = Math.max(width * 1.1, 500); 

            const svg = d3.select(`#${containerId}`).append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", [-width / 2, -height / 2, width, height]);

            const g = svg.append("g");
            
            const zoom = d3.zoom().scaleExtent([0.2, 5]).on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
            svg.call(zoom);

            const color = d3.scaleOrdinal(d3.schemeCategory10).domain([0, 10, 20, 30, 40]);
            const numberRadiusScale = d3.scaleSqrt().domain([1, d3.max(numberNodes, d => d.count) || 1]).range([15, 30]);

            const simulation = d3.forceSimulation(allNodes)
                .force("link", d3.forceLink(links).id(d => d.id).strength(0.4))
                .force("charge", d3.forceManyBody().strength(-250))
                .force("center", d3.forceCenter(0, 0))
                .force("x", d3.forceX().strength(0.1))
                .force("y", d3.forceY().strength(0.1));

            const link = g.append("g").attr("class", "links").selectAll("line").data(links).join("line");
            const node = g.append("g").attr("class", "nodes").selectAll("g").data(allNodes).join("g").call(drag(simulation));
            
            node.append("circle")
                .attr("r", d => d.type === 'date' ? 25 : numberRadiusScale(d.count))
                .attr("fill", d => d.type === 'date' ? '#f0f0f0' : color(Math.floor((d.number - 1) / 10) * 10))
                .attr("stroke", d => d.type === 'date' ? '#aaa' : '#fff');
            
            node.append("text")
                .attr("class", d => d.type === 'date' ? 'date-text' : 'number-text')
                .text(d => d.type === 'date' ? `${d.id.split('-')[1]}.${d.id.split('-')[2]}` : d.number);

            simulation.on("tick", () => {
                link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });

            const allLinks = g.selectAll('.links line');
            const allNodesSelection = g.selectAll('.nodes g');

            node.on("mouseover", (event, d) => {
                const connected = new Set();
                if (d.type === 'date') {
                    connected.add(d.id);
                    allLinks.each(function(l) {
                        if (l.source.id === d.id) connected.add(l.target.id);
                    });
                } else { 
                    connected.add(d.id);
                    allLinks.each(function(l) {
                        if (l.target.id === d.id) connected.add(l.source.id);
                    });
                }

                allNodesSelection.style('opacity', n => connected.has(n.id) ? 1 : 0.1);
                allLinks
                    .style('stroke-opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 1 : 0.1)
                    .style('stroke', l => (l.source.id === d.id || l.target.id === d.id) ? '#333' : '#ddd');

            }).on("mouseout", () => {
                allNodesSelection.style('opacity', 1);
                allLinks.style('stroke-opacity', 0.7).style('stroke', '#ccc');
            });
            
            return simulation;
        }

        function drag(simulation) {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.1).restart(); 
                d.fx = d.x;
                d.fy = d.y;
            }
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
            }
            return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
        }

        // lotto.json에서 실제 데이터 로딩
        d3.json("lotto.json").then(allRows => {
            // 날짜 형식 통일 (YYYY-MM-DD)
            allRows.forEach(d => {
                d.date = d.date.replace(/\./g, '-');
            });

            setupControls(yearSelect1, monthSelect1, true, allRows);
            setupControls(yearSelect2, monthSelect2, false, allRows);

            generateBtn1.addEventListener('click', () => {
                simulation1 = createGraph('chart-container-1', yearSelect1, monthSelect1, simulation1, allRows);
            });
            generateBtn2.addEventListener('click', () => {
                simulation2 = createGraph('chart-container-2', yearSelect2, monthSelect2, simulation2, allRows);
            });

            window.addEventListener('resize', () => {
                simulation1 = createGraph('chart-container-1', yearSelect1, monthSelect1, simulation1, allRows);
                simulation2 = createGraph('chart-container-2', yearSelect2, monthSelect2, simulation2, allRows);
            });
            
            simulation1 = createGraph('chart-container-1', yearSelect1, monthSelect1, simulation1, allRows);
            simulation2 = createGraph('chart-container-2', yearSelect2, monthSelect2, simulation2, allRows);
        }).catch(error => {
            console.error("lotto.json 로딩 실패:", error);
            document.querySelectorAll('.chart-container').forEach(el => {
                el.innerHTML = '<p style="padding:20px;color:#c00;">데이터를 불러오지 못했습니다. lotto.json 경로를 확인하세요.</p>';
            });
        });
    </script>
</body>
</html>
